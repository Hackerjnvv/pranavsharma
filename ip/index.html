<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Info Collector</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; color: #333; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a73e8; }
        .info-box { margin-top: 20px; }
        .info-item { padding: 12px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; word-break: break-all; }
        .info-item:last-child { border-bottom: none; }
        .info-item strong { color: #555; min-width: 150px; }
        .info-item span { color: #000; }
        .loader { text-align: center; font-size: 18px; color: #888; }
    </style>
</head>
<body>

<div class="container">
    <h1>Aapki Device Information</h1>
    <div id="loader" class="loader">
        <p>Jaankari collect ki jaa rahi hai, कृपया प्रतीक्षा करें...</p>
    </div>
    <div id="deviceInfo" class="info-box" style="display: none;">
        <div class="info-item">
            <strong>Device Model (Guess):</strong>
            <span id="deviceModel"></span>
        </div>
        <div class="info-item">
            <strong>Unique Fingerprint:</strong>
            <span id="fingerprint"></span>
        </div>
        <div class="info-item">
            <strong>IP Address (v4/v6):</strong>
            <span id="ipAddress"></span>
        </div>
    </div>
</div>

<script>
    // PART 1: DEVICE FINGERPRINTING CODE

    // Helper function to create a SHA-256 hash
    async function generateHash(data) {
        const encoder = new TextEncoder();
        const dataBuffer = encoder.encode(data);
        const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        return hashHex;
    }

    // Function to get the canvas fingerprint (very powerful for uniqueness)
    function getCanvasFingerprint() {
        try {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const text = "DeviceFingerprint_ID_@123#_canvas";
            ctx.textBaseline = "top";
            ctx.font = "14px 'Arial'";
            ctx.textBaseline = "alphabetic";
            ctx.fillStyle = "#f60";
            ctx.fillRect(125, 1, 62, 20);
            ctx.fillStyle = "#069";
            ctx.fillText(text, 2, 15);
            ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
            ctx.fillText(text, 4, 17);
            return canvas.toDataURL();
        } catch (e) {
            return "canvas-not-supported";
        }
    }

    // Main function to collect all device components for the fingerprint
    async function getDeviceFingerprint() {
        // Guessing device model from User Agent
        const ua = navigator.userAgent;
        let deviceModel = "Unknown";
        if (/android/i.test(ua)) {
            const match = ua.match(/;\s?([^\s;]+)\sBuild\//);
            deviceModel = match ? `Android (${match[1]})` : "Android (Generic)";
        } else if (/iphone|ipad|ipod/i.test(ua)) {
            deviceModel = ua.match(/(iPhone|iPad|iPod)/i)[0];
        } else if (/windows phone/i.test(ua)) {
            deviceModel = "Windows Phone";
        } else if (/mac/i.test(ua)) {
            deviceModel = "Mac/MacBook";
        } else if (/windows/i.test(ua)) {
            deviceModel = "Windows PC";
        }

        // Collecting all components for uniqueness
        const components = {
            userAgent: navigator.userAgent,
            language: navigator.language,
            screenResolution: `${screen.width}x${screen.height}x${screen.colorDepth}`,
            hardwareConcurrency: navigator.hardwareConcurrency || 'unknown',
            timezone: new Intl.DateTimeFormat().resolvedOptions().timeZone,
            platform: navigator.platform,
            canvasFingerprint: getCanvasFingerprint()
        };

        const values = Object.values(components).join('||');
        const fingerprint = await generateHash(values);

        return {
            deviceModel: deviceModel,
            fingerprint: fingerprint
        };
    }

    // PART 2: IP ADDRESS COLLECTION USING PUBLIC APIS

    // List of public APIs to get IP address
    const ipAPIs = [
        'https://api.ipify.org?format=json',
        'https://ipinfo.io/json',
        'https://api.my-ip.io/ip.json',
        'https://ip.seeip.org/jsonip',
        'https://api.db-ip.com/v2/free/self'
    ];

    // Function to get IP address fast and reliably
    async function getIpAddress() {
        // Create an array of fetch promises
        const promises = ipAPIs.map(api => fetch(api).then(res => res.json()));

        try {
            // Promise.any waits for the FIRST promise to resolve
            const result = await Promise.any(promises);
            // Different APIs return IP in different keys (ip, ip_address, etc.)
            return result.ip || result.ipAddress || result.ip_address || 'Not Found';
        } catch (error) {
            console.error("Could not fetch IP from any API:", error);
            return "Not Found";
        }
    }


    // PART 3: COMBINING EVERYTHING ON PAGE LOAD

    window.addEventListener('load', async () => {
        const loader = document.getElementById('loader');
        const infoDiv = document.getElementById('deviceInfo');

        // Get both fingerprint and IP address at the same time
        const [deviceInfo, ipAddress] = await Promise.all([
            getDeviceFingerprint(),
            getIpAddress()
        ]);
        
        // Update the HTML to show the collected data
        document.getElementById('deviceModel').textContent = deviceInfo.deviceModel;
        document.getElementById('fingerprint').textContent = deviceInfo.fingerprint;
        document.getElementById('ipAddress').textContent = ipAddress;

        // Hide loader and show results
        loader.style.display = 'none';
        infoDiv.style.display = 'block';

        // Log the final combined object to console
        console.log("--- Final Collected Info ---");
        console.log({
            deviceModel: deviceInfo.deviceModel,
            fingerprint: deviceInfo.fingerprint,
            ipAddress: ipAddress
        });
    });
</script>

</body>
</html>
